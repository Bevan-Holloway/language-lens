<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Language Lens</title>

    <script>
        const validCodes = new Set([
            'DEMO2024',
            'PC2025',
            'O$2TE@7B',
            'TRYME'
        ]);

        const storedCode = localStorage.getItem('languageFeaturesAccess');

        if (!validCodes.has(storedCode)) {
            window.location.href = 'index.html';
        }
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(to bottom, #f8f9fa, #e9ecef);
            min-height: 100vh;
            padding: 2rem 1rem;
            color: #2c3e50;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 2.5rem 3rem;
            border-radius: 0.5rem;
            margin-bottom: 2.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        h1 {
            color: #1e3a5f;
            font-size: 2.25rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            letter-spacing: -0.02em;
        }

        .subtitle {
            color: #64748b;
            font-size: 1.05rem;
            margin-bottom: 2rem;
            font-weight: 400;
        }

        .controls {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-box {
            flex: 1;
            min-width: 300px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 0.875rem 1.25rem 0.875rem 3rem;
            border: 1.5px solid #e2e8f0;
            border-radius: 0.375rem;
            font-size: 1rem;
            transition: all 0.2s;
            background: #f8fafc;
        }

        .search-box input:focus {
            outline: none;
            border-color: #1e3a5f;
            background: white;
            box-shadow: 0 0 0 3px rgba(30, 58, 95, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #64748b;
            font-size: 1.1rem;
        }

        .filter-controls {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .category-filter {
            padding: 0.75rem 1.25rem;
            border: 1.5px solid #e2e8f0;
            border-radius: 0.375rem;
            background: white;
            color: #475569;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .category-filter:hover {
            border-color: #1e3a5f;
            background: #f8fafc;
        }

        .category-filter.active {
            background: #1e3a5f;
            color: white;
            border-color: #1e3a5f;
        }

        .mode-toggle {
            background: #1e3a5f;
            color: white;
            border: none;
            padding: 0.875rem 1.75rem;
            border-radius: 0.375rem;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .mode-toggle:hover {
            background: #2c4a6f;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(30, 58, 95, 0.2);
        }

        /* Daily Quote Section - Collapsible */
        .daily-quote-section {
            background: white;
            padding: 1.5rem 3rem;
            border-radius: 0.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease-in-out;
            margin-bottom: 2.5rem;
        }

        .collapsible-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            color: #1e3a5f;
        }
        .collapsible-header span:first-child {
            font-size: 1.5rem;
            font-weight: 600;
            letter-spacing: -0.01em;
        }

        .toggle-icon {
            transition: transform 0.3s ease;
            font-size: 1.2rem;
            color: #64748b;
        }

        .daily-quote-section.expanded .toggle-icon {
            transform: rotate(180deg);
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-out;
        }

        .daily-quote-section.expanded .collapsible-content {
            max-height: 2000px; /* Adjust if content is taller */
            transition: max-height 0.5s ease-in;
            padding-top: 1.5rem;
            border-top: 1px solid #e2e8f0;
            margin-top: 1.5rem;
        }
        
        .quote-content {
            margin-bottom: 2rem;
        }

        .daily-quote-section blockquote {
            font-size: 1.25rem;
            font-style: italic;
            color: #334155;
            border-left: 4px solid #1e3a5f;
            padding-left: 1.5rem;
            margin: 0 0 1rem 0;
            line-height: 1.6;
        }

        .daily-quote-section cite {
            display: block;
            text-align: right;
            color: #64748b;
            font-style: normal;
            font-weight: 500;
            font-size: 0.95rem;
        }
        
        .technique-tags {
            margin-bottom: 1.5rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .technique-tag-link {
            font-size: 0.75rem;
            color: #64748b;
            background: #f1f5f9;
            padding: 0.25rem 0.75rem;
            border-radius: 0.25rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        .technique-tag-link:hover {
            background: #e2e8f0;
            color: #1e3a5f;
        }

        /* Analysis Section (for explanation) - Match card's effect section */
        .analysis-section {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            padding: 1.25rem 1.5rem;
            border-radius: 0.375rem;
            border: 1px solid #bae6fd;
            margin-bottom: 1rem;
        }

        .section-label {
            color: #0c4a6e;
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .effect-text {
            color: #334155;
            line-height: 1.6;
            font-size: 0.95rem;
            margin-bottom: 1rem;
        }
        .effect-text:last-child {
            margin-bottom: 0;
        }

        /* Purpose Section (for why it matters) - Match card's purpose section */
        .purpose-section {
            background: linear-gradient(135deg, #fffbf5, #fef5e7);
            padding: 1.25rem 1.5rem;
            border-radius: 0.375rem;
            border: 1px solid #fde8cc;
        }

        .purpose-section .section-label {
            color: #6b21a8;
        }
        .purpose-section .effect-text {
            font-style: italic;
        }

        .purpose-item {
            margin-bottom: 0.875rem;
        }
        .purpose-item:last-child {
            margin-bottom: 0;
        }

        /* Reference Gallery Mode */
        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 2rem;
        }

        .feature-card {
            background: white;
            border-radius: 0.5rem;
            padding: 2rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            transition: all 0.3s;
            cursor: pointer;
        }

        .feature-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .feature-name {
            color: #1e3a5f;
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1.25rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            letter-spacing: -0.01em;
        }

        .bookmark-btn {
            background: none;
            border: none;
            font-size: 1.35rem;
            cursor: pointer;
            opacity: 0.2;
            transition: opacity 0.2s;
            padding: 0.25rem;
        }

        .bookmark-btn:hover {
            opacity: 0.6;
        }

        .bookmark-btn.active {
            opacity: 1;
            color: #1e3a5f;
        }

        .category-tag {
            display: inline-block;
            font-size: 0.75rem;
            color: #64748b;
            background: #f1f5f9;
            padding: 0.25rem 0.75rem;
            border-radius: 0.25rem;
            margin-bottom: 1rem;
            font-weight: 500;
        }

        .definition {
            color: #475569;
            margin-bottom: 1.25rem;
            line-height: 1.7;
            font-size: 0.975rem;
        }

        .example {
            font-style: italic;
            color: #64748b;
            margin-bottom: 1.5rem;
            padding: 1rem 1.25rem;
            background: #f8fafc;
            border-radius: 0.375rem;
            border-left: 3px solid #cbd5e1;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .analysis-questions {
            color: #0c4a6e;
            font-weight: 600;
            margin-bottom: 0.625rem;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .questions-list {
            list-style: none;
            padding: 0;
        }

        .questions-list li {
            color: #334155;
            line-height: 1.6;
            margin-bottom: 0.5rem;
            padding-left: 1.25rem;
            position: relative;
            font-size: 0.925rem;
        }

        .questions-list li::before {
            content: '•';
            position: absolute;
            left: 0;
            color: #0c4a6e;
            font-weight: bold;
        }

        .purpose-section .questions-list li::before {
            color: #6b21a8;
        }

        .questions-list li:last-child {
            margin-bottom: 0;
        }

        .purpose-item .purpose-heading {
            color: #7c3aed;
            font-weight: 600;
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }

        .purpose-item .purpose-text {
            color: #334155;
            font-size: 0.9rem;
            line-height: 1.5;
            font-style: italic;
        }

        /* Modal Overlay */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            overflow-y: auto;
            padding: 2rem 1rem;
        }

        .modal-overlay.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 0.5rem;
            max-width: 900px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            margin: auto;
        }

        .modal-inner {
            padding: 2.5rem 3rem;
        }

        .modal-close {
            position: sticky;
            top: 0;
            right: 0;
            float: right;
            background: #1e3a5f;
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            z-index: 1;
            margin-bottom: 1rem;
        }

        .modal-close:hover {
            background: #2c4a6f;
            transform: scale(1.1);
        }

        /* Flashcard Mode */
        .flashcard-container {
            display: none;
            max-width: 900px;
            margin: 0 auto;
        }

        .flashcard-container.active {
            display: block;
        }

        .flashcard {
            background: white;
            border-radius: 0.5rem;
            padding: 3.5rem 3rem;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            min-height: 500px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .flashcard:hover {
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
        }

        .flashcard-front {
            text-align: center;
        }

        .flashcard-front .feature-name {
            font-size: 2.75rem;
            color: #1e3a5f;
            justify-content: center;
            margin-bottom: 1.5rem;
        }

        .flashcard-front .tap-hint {
            color: #94a3b8;
            font-size: 0.95rem;
            margin-top: 2.5rem;
        }

        .flashcard-back {
            display: none;
        }

        .flashcard.flipped .flashcard-front {
            display: none;
        }

        .flashcard.flipped .flashcard-back {
            display: block;
        }

        .flashcard-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 2rem;
        }
        
        .flashcard-nav-center {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .nav-btn {
            background: #1e3a5f;
            color: white;
            border: none;
            padding: 0.875rem 1.75rem;
            border-radius: 0.375rem;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        #randomiseBtn {
            background-color: #f1f5f9;
            color: #475569;
            padding: 0.75rem 1.25rem;
            font-size: 0.9rem;
        }
        
        #randomiseBtn:hover {
             background-color: #e2e8f0;
             transform: translateY(-1px);
        }

        .nav-btn:hover:not(:disabled) {
            background: #2c4a6f;
            transform: translateY(-1px);
        }

        .nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .card-counter {
            color: #475569;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .hidden {
            display: none !important;
        }

        .no-results {
            text-align: center;
            padding: 4rem 2rem;
            color: #64748b;
            font-size: 1.1rem;
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            margin-bottom: 2.5rem;
        }

        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }

            header {
                padding: 1.5rem;
            }

            h1 {
                font-size: 1.75rem;
            }

            .daily-quote-section {
                padding: 1rem 1.5rem;
            }
             .collapsible-header span:first-child {
                font-size: 1.25rem;
            }
            .daily-quote-section blockquote {
                font-size: 1.1rem;
            }

            .gallery {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }

            .feature-card {
                padding: 1.5rem;
            }

            .flashcard {
                padding: 2rem 1.5rem;
            }
            .flashcard-navigation {
                flex-wrap: wrap;
                justify-content: center;
                gap: 1rem;
            }
            .flashcard-nav-center {
                order: -1;
                width: 100%;
                justify-content: center;
            }

            .flashcard-front .feature-name {
                font-size: 2rem;
            }

            .modal-overlay {
                padding: 1rem;
            }

            .modal-inner {
                padding: 1.5rem;
            }

            .modal-content {
                width: 95%;
                max-height: 85vh;
            }
        }

        @media print {
            body {
                background: white;
            }

            .controls, .mode-toggle, .bookmark-btn, .filter-controls, .daily-quote-section {
                display: none !important;
            }

            .feature-card {
                break-inside: avoid;
                page-break-inside: avoid;
                box-shadow: none;
                border: 1px solid #e2e8f0;
                margin-bottom: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Language Lens</h1>
            <p class="subtitle">A comprehensive guide to literary devices, grammar, and sentence structure for text analysis</p>
            
            <div class="controls">
                <div class="search-box" id="searchBox">
                    <span class="search-icon">🔍</span>
                    <input type="text" id="searchInput" placeholder="Search features...">
                </div>
                <button class="mode-toggle" id="modeToggle">Switch to Flashcard Mode</button>
            </div>
            
            <div class="filter-controls" id="filterControls" style="margin-top: 1.5rem;">
                <button class="category-filter active" data-category="all">All Features</button>
                <button class="category-filter" id="bookmarkFilterBtn">🔖 Show Bookmarked</button>
            </div>
        </header>

        <main>
            <section class="daily-quote-section" id="dailyQuoteSection">
                <h2 class="collapsible-header" id="quoteHeader">
                    <span>Daily Quote Analysis 💡</span>
                    <span class="toggle-icon">▼</span>
                </h2>
                <div class="collapsible-content" id="quoteContent">
                    <div class="quote-content">
                        <blockquote id="dailyQuoteText"></blockquote>
                        <cite id="dailyQuoteSource"></cite>
                    </div>
                    <div id="dailyQuoteAnalysis"></div>
                </div>
            </section>

            <div class="gallery" id="gallery"></div>
            <div class="no-results hidden" id="noResults">No features found matching your search or filter.</div>

            <div class="flashcard-container" id="flashcardContainer">
                <div class="flashcard" id="flashcard">
                    <div class="flashcard-front">
                        <div class="category-tag" id="flashcardCategoryFront"></div>
                        <div class="feature-name" id="flashcardName"></div>
                        <p class="tap-hint">Click to reveal details ▼</p>
                    </div>
                    <div class="flashcard-back">
                        <div class="category-tag" id="flashcardCategory"></div>
                        <div class="feature-name" id="flashcardNameBack"></div>
                        <div class="definition" id="flashcardDefinition"></div>
                        <div class="example" id="flashcardExample"></div>
                        <div class="analysis-section" id="flashcardAnalysis"></div>
                    </div>
                </div>
                
                <div class="flashcard-navigation">
                    <button class="nav-btn" id="prevBtn">← Previous</button>
                    <div class="flashcard-nav-center">
                        <div class="card-counter" id="counter"></div>
                        <button class="nav-btn" id="randomiseBtn">🔀 Randomise</button>
                    </div>
                    <button class="nav-btn" id="nextBtn">Next →</button>
                </div>
            </div>
        </main>
    </div>

    <div class="modal-overlay" id="modalOverlay">
        <div class="modal-content" id="modalContent">
            <div class="modal-inner">
                <button class="modal-close" id="modalClose">&times;</button>
                <div id="modalBody"></div>
            </div>
        </div>
    </div>

    <script>
        const features = [
            // SOUND DEVICES
            {
                name: "Adjectives",
                category: "Parts of Speech",
                definition: "Descriptive words that modify nouns, providing specific details about their qualities, characteristics, or states.",
                example: "The <strong>ancient</strong>, <strong>weathered</strong> manuscript revealed secrets.",
                effect: "Add precision, create vivid imagery, and shape the reader's perception of people, places, or things.",
                questions: [
                    "What specific qualities do the adjectives emphasise?",
                    "How do they influence your impression of the subject?",
                    "Why did the writer choose these particular descriptors?"
                ],
                purposes: {
                    connect: "How do descriptive words shape cultural perceptions and stereotypes?",
                    understand: "What emotions or judgments do these descriptive words trigger in you?",
                    recognise: "How does the writer use selection of adjectives to guide your feelings?",
                    question: "What biases or assumptions do these descriptive choices reveal?"
                }
            },
            {
                name: "Alliteration",
                category: "Sound Devices",
                definition: "The repetition of the same initial consonant sound in words that are close together in a phrase or sentence.",
                example: "Peter Piper picked a peck of pickled peppers.",
                effect: "Creates rhythm and draws attention to specific words or ideas.",
                questions: [
                    "What mood does the sound create - soft and soothing, or harsh and aggressive?",
                    "Which words are being emphasised through the repeated sound?",
                    "Why did the writer want to draw attention to these particular words?"
                ],
                purposes: {
                    connect: "How does this sound pattern draw on poetic or literary traditions you recognise?",
                    understand: "What emotion or memory does this sound evoke in you as a reader?",
                    recognise: "How does the writer use sound to make certain words stand out or stick in your mind?",
                    question: "Does the pleasant or harsh sound influence how you feel about what's being described?"
                }
            },
            {
                name: "Foreshadowing",
                category: "Structural Devices",
                definition: "Hints or clues about events that will occur later in the narrative.",
                example: "There are dark clouds gathering on the horizon.",
                effect: "Builds anticipation, creates tension, and prepares readers for future events.",
                questions: [
                    "What is being hinted at or suggested?",
                    "How does this create expectations about what might happen?",
                    "Why did the writer want to prepare us for what's coming?"
                ],
                purposes: {
                    connect: "How does foreshadowing connect to storytelling traditions and prophecy?",
                    understand: "How does anticipating future events change your experience of the present?",
                    recognise: "How does the writer plant clues to create suspense and structure?",
                    question: "Does foreshadowing suggest fate and inevitability, or just careful planning?"
                }
            },
            {
                name: "Metaphor",
                category: "Figurative Language",
                definition: "A direct comparison between two unlike things without using 'like' or 'as.' It states that one thing is another.",
                example: "The world is a stage.",
                effect: "Creates powerful connections and helps readers see things in new ways.",
                questions: [
                    "What two things are being compared?",
                    "What qualities are transferred from one to the other?",
                    "Why did the writer choose this particular comparison?"
                ],
                purposes: {
                    connect: "How does this metaphor draw on familiar cultural or literary references?",
                    understand: "What new way of seeing yourself or the world does this comparison offer?",
                    recognise: "How does this metaphor shape your emotional or intellectual response?",
                    question: "Whose worldview or values does this comparison reinforce or challenge?"
                }
            },
            {
                name: "Personification",
                category: "Figurative Language",
                definition: "Giving human qualities or actions to inanimate objects or abstract ideas.",
                example: "The wind whispered through the trees.",
                effect: "Makes non-human things relatable and vivid by bringing them to life.",
                questions: [
                    "What non-human thing is being given human qualities?",
                    "What human characteristics are assigned to it?",
                    "Why does the writer want us to see this thing as human-like?"
                ],
                purposes: {
                    connect: "How does this connect to myths, fables, or cultural stories about nature?",
                    understand: "How does seeing nature as alive change your relationship with it?",
                    recognise: "How does the writer make abstract or distant things feel closer and more relatable?",
                    question: "Does treating nature as human help us care for it, or does it centre human experience?"
                }
            },
            {
                name: "Repetition",
                category: "Structural Devices",
                definition: "The simple act of repeating a word, phrase, or sentence.",
                example: "The politician promised change, change, and more change.",
                effect: "Emphasises key ideas and creates rhythm, building intensity or urgency.",
                questions: [
                    "What specific words or phrases are being repeated?",
                    "How does the repetition affect the tone or emotional intensity?",
                    "Why does the writer want to hammer this point home?"
                ],
                purposes: {
                    connect: "How does repetition connect to advertising, political slogans, or cultural mantras?",
                    understand: "Does the repetition convince you or make you suspicious?",
                    recognise: "How does the writer use repetition to persuade or manipulate?",
                    question: "Is the repetition used to inspire or to overwhelm critical thinking?"
                }
            },
            {
                name: "Rhetorical Question",
                category: "Figurative Language",
                definition: "A question asked for effect rather than to elicit an answer.",
                example: "Are we going to sit here and do nothing?",
                effect: "Provokes thought and engages the reader, often implying an obvious answer.",
                questions: [
                    "What is the implied or obvious answer to this question?",
                    "How does this engage or challenge the reader?",
                    "Why did the writer choose to question rather than state directly?"
                ],
                purposes: {
                    connect: "How do rhetorical questions appear in speeches, debates, and persuasive texts?",
                    understand: "How does being questioned make you feel - challenged, engaged, or manipulated?",
                    recognise: "How does the writer use questions to guide you toward a particular answer?",
                    question: "Does the 'obvious' answer really allow for other perspectives?"
                }
            },
            {
                name: "Simple Sentence",
                category: "Sentences",
                definition: "A sentence with one independent clause containing a subject and verb, expressing a complete thought.",
                example: "The cat slept.",
                effect: "Creates clarity, emphasis, and directness through brevity.",
                questions: [
                    "What single idea is being expressed?",
                    "How does the simplicity affect the pace and clarity?",
                    "Why did the writer use a simple structure here?"
                ],
                purposes: {
                    connect: "How do simple sentences mirror children's language and learning?",
                    understand: "How does simplicity make you feel - clarity or oversimplification?",
                    recognise: "How does the writer use simple sentences for emphasis or pacing?",
                    question: "Does simplicity clarify or does it hide complexity?"
                }
            },   
        ];

        const dailyQuotes = [
            {
                text: "The mass of men lead lives of quiet desperation.",
                author: "Henry David Thoreau",
                source: "Walden (1854)",
                techniques: ["Hyperbole", "Alliteration"],
                analysis: "Thoreau uses <strong>hyperbole</strong> to make the provocative claim that most people live in 'quiet desperation'. This exaggeration is amplified by the soft <strong>alliteration</strong> in 'lead lives', which adds to the sense of hushed, unspoken suffering. Together, these techniques create a powerful and memorable critique of conformity.",
                matters: "By moving beyond a simple observation to a grand, dramatic statement, Thoreau forces the reader to confront their own life. The analysis isn't just about societal critique; it's a personal challenge. It prompts us to question whether our own pursuit of stability and social acceptance has come at the cost of genuine fulfillment, turning a sociological observation into a timeless philosophical question about what it means to live an authentic life."
            },
            {
                text: "It was the best of times, it was the worst of times...",
                author: "Charles Dickens",
                source: "A Tale of Two Cities (1859)",
                techniques: ["Anaphora", "Antithesis", "Parallel Structure"],
                analysis: "Dickens employs <strong>anaphora</strong> by repeating the phrase 'it was the' to build a powerful, rhythmic cadence. This repetition structures a series of direct contrasts, or <strong>antithesis</strong> ('best'/'worst', 'wisdom'/'foolishness'). The use of <strong>parallel structure</strong> across these clauses gives the contradictions a sense of epic scale and balance.",
                matters: "This opening immediately establishes the novel's central theme of duality. Rather than presenting a simple view of the past, the language forces the reader to hold opposing ideas in their mind simultaneously. This complexity suggests that truth is not simple and that every era is defined by its contradictions, setting the stage for a story where personal and political loyalties are constantly in conflict."
            },
            {
                text: "Because I could not stop for Death – He kindly stopped for me –",
                author: "Emily Dickinson",
                source: "Poem 712 (c. 1863)",
                techniques: ["Personification", "Irony", "Caesura"],
                analysis: "Dickinson uses <strong>personification</strong> to portray Death as a polite gentleman in a carriage. This gentle image is contrasted with the reality of death, creating a profound <strong>irony</strong>. The <strong>caesura</strong> (the dash) creates a pause, forcing the reader to contemplate this strange, courteous image of mortality before the line concludes.",
                matters: "By transforming death from a terrifying force into a gentle suitor, the poem challenges our fundamental fears. The analysis shows how this gentle tone creates a contemplative mood, allowing the speaker to explore the journey towards the afterlife without fear. It reframes mortality not as an end, but as a transition, prompting a deeper reflection on the nature of eternity and our place within it."
            },
            {
                text: "All the world's a stage, And all the men and women merely players;",
                author: "William Shakespeare",
                source: "As You Like It (c. 1599)",
                techniques: ["Metaphor", "Parallel Structure"],
                analysis: "Shakespeare uses a direct <strong>metaphor</strong> to frame life as a theatrical performance, stating the world <strong>is</strong> a stage. This comparison is extended through <strong>parallel structure</strong> in the two lines ('All the...'), creating a balanced, memorable rhythm that gives the idea a sense of universal truth.",
                matters: "This metaphor provides a powerful framework for understanding human existence. It suggests our lives follow a pre-written script with set roles, entrances, and exits. This perspective can feel fatalistic, but it also connects every individual's personal story to a larger, shared human drama, highlighting the common experiences that unite us across time."
            },
        ];

        const categories = ['all', ...new Set(features.map(f => f.category))];
        let currentMode = 'gallery';
        let currentCardIndex = 0;
        let currentCategory = 'all';
        let showingBookmarksOnly = false;
        let filteredFeatures = [...features];
        let bookmarks = JSON.parse(localStorage.getItem('languageFeatureBookmarks') || '[]');
        let flashcardOrder = [];

        const gallery = document.getElementById('gallery');
        const flashcardContainer = document.getElementById('flashcardContainer');
        const modeToggle = document.getElementById('modeToggle');
        const searchInput = document.getElementById('searchInput');
        const searchBox = document.getElementById('searchBox');
        const noResults = document.getElementById('noResults');
        const flashcard = document.getElementById('flashcard');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const counter = document.getElementById('counter');
        const randomiseBtn = document.getElementById('randomiseBtn');
        const filterControls = document.getElementById('filterControls');
        const bookmarkFilterBtn = document.getElementById('bookmarkFilterBtn');
        const modalOverlay = document.getElementById('modalOverlay');
        const modalClose = document.getElementById('modalClose');
        const modalBody = document.getElementById('modalBody');
        
        // Quote Section Elements
        const quoteSection = document.getElementById('dailyQuoteSection');
        const quoteHeader = document.getElementById('quoteHeader');
        const dailyQuoteText = document.getElementById('dailyQuoteText');
        const dailyQuoteSource = document.getElementById('dailyQuoteSource');
        const dailyQuoteAnalysis = document.getElementById('dailyQuoteAnalysis');

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function initializeFlashcards() {
            flashcardOrder = Array.from(features.keys());
            currentCardIndex = 0;
        }

        function displayDailyQuote() {
            function getDayOfYear() {
                const now = new Date();
                const start = new Date(now.getFullYear(), 0, 0);
                const diff = now - start;
                const oneDay = 1000 * 60 * 60 * 24;
                return Math.floor(diff / oneDay);
            }

            const dayIndex = getDayOfYear() % dailyQuotes.length;
            const quote = dailyQuotes[dayIndex];

            dailyQuoteText.innerHTML = `“${quote.text}”`;
            dailyQuoteSource.textContent = `— ${quote.author}, ${quote.source}`;
            
            const techniqueTagsHtml = quote.techniques.map(tech => 
                `<span class="technique-tag-link" data-feature="${tech}">${tech}</span>`
            ).join('');

            dailyQuoteAnalysis.innerHTML = `
                <div class="technique-tags">${techniqueTagsHtml}</div>
                <div class="analysis-section">
                    <div class="section-label">Analysis</div>
                    <div class="effect-text">${quote.analysis}</div>
                </div>
                <div class="purpose-section">
                    <div class="section-label">Why it Matters</div>
                    <div class="effect-text">${quote.matters}</div>
                </div>
            `;
        }

        quoteHeader.addEventListener('click', () => {
            quoteSection.classList.toggle('expanded');
        });

        dailyQuoteAnalysis.addEventListener('click', (e) => {
            const tag = e.target.closest('.technique-tag-link');
            if (tag) {
                const featureName = tag.dataset.feature;
                if (currentMode === 'flashcard') {
                    modeToggle.click();
                }
                searchInput.value = featureName;
                filterByCategory('all');
                applyFilters();
                searchInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
                searchInput.focus();
            }
        });

        categories.forEach(cat => {
            if (cat === 'all') return;
            const btn = document.createElement('button');
            btn.className = 'category-filter';
            btn.dataset.category = cat;
            btn.textContent = cat;
            btn.addEventListener('click', () => filterByCategory(cat));
            filterControls.appendChild(btn);
        });
        
        displayDailyQuote();
        renderGallery();

        bookmarkFilterBtn.addEventListener('click', () => {
            showingBookmarksOnly = !showingBookmarksOnly;
            
            bookmarkFilterBtn.classList.toggle('active', showingBookmarksOnly);
            if (showingBookmarksOnly) {
                document.querySelectorAll('.category-filter[data-category]').forEach(btn => {
                    btn.classList.remove('active');
                });
            } else {
                document.querySelector('[data-category="all"]').classList.add('active');
                currentCategory = 'all';
            }
            
            applyFilters();
        });

        function filterByCategory(category) {
            showingBookmarksOnly = false;
            bookmarkFilterBtn.classList.remove('active');
            
            currentCategory = category;
            document.querySelectorAll('.category-filter').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            applyFilters();
        }

        function applyFilters() {
            const searchTerm = searchInput.value.toLowerCase();
            filteredFeatures = features.filter(f => {
                const isBookmarked = bookmarks.includes(f.name);
                const matchesSearch = !searchTerm || 
                    f.name.toLowerCase().includes(searchTerm) ||
                    f.definition.toLowerCase().includes(searchTerm) ||
                    f.effect.toLowerCase().includes(searchTerm) ||
                    f.category.toLowerCase().includes(searchTerm);

                if (showingBookmarksOnly) {
                    return isBookmarked && matchesSearch;
                } else {
                    const matchesCategory = currentCategory === 'all' || f.category === currentCategory;
                    return matchesCategory && matchesSearch;
                }
            });
            renderGallery();
        }

        modeToggle.addEventListener('click', () => {
            if (currentMode === 'gallery') {
                currentMode = 'flashcard';
                gallery.classList.add('hidden');
                noResults.classList.add('hidden');
                flashcardContainer.classList.add('active');
                searchBox.style.display = 'none';
                filterControls.style.display = 'none';
                modeToggle.textContent = 'Switch to Reference Mode';
                initializeFlashcards();
                renderFlashcard();
            } else {
                currentMode = 'gallery';
                flashcardContainer.classList.remove('active');
                searchBox.style.display = '';
                filterControls.style.display = 'flex';
                modeToggle.textContent = 'Switch to Flashcard Mode';
                flashcard.classList.remove('flipped');
                searchInput.value = '';
                applyFilters();
            }
        });

        searchInput.addEventListener('input', applyFilters);

        function renderGallery() {
            gallery.innerHTML = '';
            if (filteredFeatures.length === 0) {
                noResults.classList.remove('hidden');
                gallery.classList.add('hidden');
                return;
            }
            noResults.classList.add('hidden');
            gallery.classList.remove('hidden');
            
            filteredFeatures.forEach((feature) => {
                const card = document.createElement('div');
                card.className = 'feature-card';
                const isBookmarked = bookmarks.includes(feature.name);
                const questionsList = feature.questions.map(q => `<li>${q}</li>`).join('');
                
                card.innerHTML = `
                    <div class="category-tag">${feature.category}</div>
                    <div class="feature-name">
                        <span>${feature.name}</span>
                        <button class="bookmark-btn ${isBookmarked ? 'active' : ''}" data-name="${feature.name}">
                            ${isBookmarked ? '★' : '☆'}
                        </button>
                    </div>
                    <div class="definition">${feature.definition}</div>
                    <div class="example">${feature.example}</div>
                    <div class="analysis-section">
                        <div class="section-label">Effect</div>
                        <div class="effect-text">${feature.effect}</div>
                        <div class="analysis-questions">When Analysing Language, Ask</div>
                        <ul class="questions-list">${questionsList}</ul>
                    </div>
                    <div class="purpose-section">
                        <div class="section-label">When Analysing Why This Matters, You Can</div>
                        <div class="purpose-item">
                            <div class="purpose-heading">Connect to the Wider World:</div>
                            <div class="purpose-text">${feature.purposes.connect}</div>
                        </div>
                        <div class="purpose-item">
                            <div class="purpose-heading">Understand Ourselves:</div>
                            <div class="purpose-text">${feature.purposes.understand}</div>
                        </div>
                        <div class="purpose-item">
                            <div class="purpose-heading">Recognise the Craft:</div>
                            <div class="purpose-text">${feature.purposes.recognise}</div>
                        </div>
                        <div class="purpose-item">
                            <div class="purpose-heading">Question the Text:</div>
                            <div class="purpose-text">${feature.purposes.question}</div>
                        </div>
                    </div>
                `;
                
                card.addEventListener('click', (e) => {
                    if (!e.target.closest('.bookmark-btn')) {
                        openModal(feature);
                    }
                });
                
                gallery.appendChild(card);
            });

            document.querySelectorAll('.bookmark-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleBookmark(btn.dataset.name);
                });
            });
        }

        function toggleBookmark(name) {
            const index = bookmarks.indexOf(name);
            if (index > -1) {
                bookmarks.splice(index, 1);
            } else {
                bookmarks.push(name);
            }
            localStorage.setItem('languageFeatureBookmarks', JSON.stringify(bookmarks));
            renderGallery();
        }

        function openModal(feature) {
            const questionsList = feature.questions.map(q => `<li>${q}</li>`).join('');
            modalBody.innerHTML = `
                <div class="category-tag">${feature.category}</div>
                <div class="feature-name"><span>${feature.name}</span></div>
                <div class="definition">${feature.definition}</div>
                <div class="example">${feature.example}</div>
                <div class="analysis-section">
                    <div class="section-label">Effect</div>
                    <div class="effect-text">${feature.effect}</div>
                    <div class="analysis-questions">When Analysing Language, Ask</div>
                    <ul class="questions-list">${questionsList}</ul>
                </div>
                <div class="purpose-section">
                    <div class="section-label">When Exploring Why This Matters, You Can</div>
                    <div class="purpose-item">
                        <div class="purpose-heading">Connect to the Wider World:</div>
                        <div class="purpose-text">${feature.purposes.connect}</div>
                    </div>
                    <div class="purpose-item">
                        <div class="purpose-heading">Understand Ourselves:</div>
                        <div class="purpose-text">${feature.purposes.understand}</div>
                    </div>
                    <div class="purpose-item">
                        <div class="purpose-heading">Recognise the Craft:</div>
                        <div class="purpose-text">${feature.purposes.recognise}</div>
                    </div>
                    <div class="purpose-item">
                        <div class="purpose-heading">Question the Text:</div>
                        <div class="purpose-text">${feature.purposes.question}</div>
                    </div>
                </div>
            `;
            modalOverlay.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            modalOverlay.classList.remove('active');
            document.body.style.overflow = '';
        }

        modalClose.addEventListener('click', closeModal);
        modalOverlay.addEventListener('click', (e) => {
            if (e.target === modalOverlay) closeModal();
        });

        function renderFlashcard() {
            const featureIndex = flashcardOrder[currentCardIndex];
            const feature = features[featureIndex];

            document.getElementById('flashcardCategoryFront').textContent = feature.category;
            document.getElementById('flashcardCategory').textContent = feature.category;
            document.getElementById('flashcardName').textContent = feature.name;
            document.getElementById('flashcardNameBack').textContent = feature.name;
            document.getElementById('flashcardDefinition').textContent = feature.definition;
            document.getElementById('flashcardExample').innerHTML = `${feature.example}`;
            document.getElementById('flashcardAnalysis').innerHTML = `
                <div class="section-label">Effect</div>
                <div class="effect-text">${feature.effect}</div>
            `;
            counter.textContent = `${currentCardIndex + 1} of ${flashcardOrder.length}`;
            prevBtn.disabled = currentCardIndex === 0;
            nextBtn.disabled = currentCardIndex === flashcardOrder.length - 1;
        }

        flashcard.addEventListener('click', () => flashcard.classList.toggle('flipped'));
        
        prevBtn.addEventListener('click', () => {
            if (currentCardIndex > 0) {
                currentCardIndex--;
                flashcard.classList.remove('flipped');
                renderFlashcard();
            }
        });

        nextBtn.addEventListener('click', () => {
            if (currentCardIndex < flashcardOrder.length - 1) {
                currentCardIndex++;
                flashcard.classList.remove('flipped');
                renderFlashcard();
            }
        });

        randomiseBtn.addEventListener('click', () => {
            shuffleArray(flashcardOrder);
            currentCardIndex = 0;
            flashcard.classList.remove('flipped');
            renderFlashcard();
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && modalOverlay.classList.contains('active')) {
                closeModal();
            }
            if (currentMode === 'flashcard') {
                if (e.key === 'ArrowLeft') prevBtn.click();
                if (e.key === 'ArrowRight') nextBtn.click();
                if (e.key === ' ' || e.key === 'Enter') {
                    e.preventDefault();
                    flashcard.classList.toggle('flipped');
                }
            }
        });

        document.querySelector('[data-category="all"]').addEventListener('click', (e) => filterByCategory(e.target.dataset.category));
    </script>
</body>
</html>